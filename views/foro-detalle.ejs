<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Foro Estudiantil - I.E. COMFAMILIAR</title>
  <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/logo2.png">

  <style>
    #logocabeza{
      height: 180px;
      margin-top: -40px;
      margin-bottom: -40px;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <header class="bg-green-800 text-white py-4 px-6 shadow-md">
    <div class="container mx-auto flex justify-between items-center">
      <div>
        <h1 class="text-3xl font-bold">I.E. COMFAMILIAR</h1>
        <p class="text-sm">Foro Estudiantil</p>
      </div>
      <div class="items-center">
        <a href="/inicio"><img src="/logo2.png" id="logocabeza"></a>
      </div>
      <div class="text-right">
        <p class="text-sm">Año 2025 - Edición #1</p>
        <p class="text-sm">"Educación con valores para el futuro"</p>
      </div>
    </div>
  </header>

   <!-- Barra de Navegación -->
  <nav class="bg-green-700 text-white py-2 px-6 shadow-sm">
    <div class="container mx-auto flex justify-between items-center">
      <div class="flex space-x-6">
        <a href="/inicio" class="hover:underline">Inicio</a>
        <a href="/novedades" class="hover:underline">Novedades</a>
        <a href="/trabajos" class="hover:underline">Trabajos</a>
        <a href="/foro" class="hover:underline">Foro</a>
        <a href="/subir-trabajos" class="hover:underline">Subir Trabajos</a>
        <a href="/logout" class="hover:text-red-400 hover:font-semibold">Cerrar Sesión</a>
      </div>
      <span class="font-semibold">Bienvenido/a, <%= datos1.nomusr %></span>
    </div>
  </nav>

  <main class="container mx-auto p-6">
  <h2 class="text-2xl font-bold text-green-800 border-b-2 border-green-800 pb-2 mb-6">Detalle de la Publicación</h2>

<section id="posts">
  <div class="space-y-4">
    <% if (publicacion) { %>
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-2xl font-bold text-green-800 mb-2"><%= publicacion.nombre_publicacion %></h3>
        <p class="text-gray-700 mb-4"><%= publicacion.contenido_publicacion %></p>
        
        <!-- Info de la publicación -->
        <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
          <div>
            <span>Publicado por: <%= publicacion.autor_publicacion %></span>
            <% if (publicacion.fecha_publicacion) { %>
              <span class="ml-4"><%= new Date(publicacion.fecha_publicacion).toLocaleDateString('es-ES') %></span>
            <% } %>
          </div>
        </div>

        <!-- Botón y área de respuesta -->
        <div class="mt-6 border-t pt-4">
          <button id="btnResponder" 
                  class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
            Responder
          </button>

          <div id="areaRespuesta" class="hidden mt-4">
            <form action="/responder" method="POST" class="space-y-4">
               <input type="hidden" name="nombre_publicacion" value="<%= publicacion.nombre_publicacion %>">
              <input type="hidden" name="id_publicacion" value="<%= publicacion.id_publicacion %>">
              <textarea name="contenido_respuesta" 
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        rows="4" 
                        placeholder="Escribe tu respuesta aquí..."></textarea>
              <div class="flex justify-end space-x-2">
                <button type="button" 
                        id="btnCancelar"
                        class="px-4 py-2 text-gray-600 hover:text-gray-800">
                  Cancelar
                </button>
                <button type="submit"
                        class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">
                  Enviar respuesta
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    <% } else { %>
      <div class="bg-white rounded-lg shadow-md p-6 text-center text-gray-500">
        <p>Publicación no encontrada.</p>
      </div>
    <% } %>

    <!-- Sección de Respuestas -->
    <div class="mt-8">
      <h3 class="text-xl font-bold text-green-800 mb-4">Respuestas</h3>
      
      <div class="space-y-4">
        <% if (respuestas && respuestas.length > 0) { %>
          <% respuestas.forEach(respuesta => { %>
            <div class="bg-white rounded-lg shadow-md p-4">
              <p class="text-gray-700 mb-2"><%= respuesta.contenido_respuesta %></p>
              <div class="flex justify-between items-center text-sm text-gray-500">
                <span>Por: <%= respuesta.autor_respuesta %></span>
                <% if (respuesta.fecha_respuesta) { %>
                  <span><%= new Date(respuesta.fecha_respuesta).toLocaleDateString('es-ES') %></span>
                <% } %>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <div class="bg-white rounded-lg shadow-md p-4 text-center text-gray-500">
            <p>No hay respuestas aún.</p>
          </div>
        <% } %>
      </div>
    </div>
  </div>

  <a href="/foro" class="inline-block mt-4 text-green-700">← Volver al foro</a>
</section>

<!-- Script para manejar el botón de respuesta -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const btnResponder = document.getElementById('btnResponder');
    const btnCancelar = document.getElementById('btnCancelar');
    const areaRespuesta = document.getElementById('areaRespuesta');

    btnResponder.addEventListener('click', function() {
      areaRespuesta.classList.remove('hidden');
      btnResponder.classList.add('hidden');
    });

    btnCancelar.addEventListener('click', function() {
      areaRespuesta.classList.add('hidden');
      btnResponder.classList.remove('hidden');
    });
  });
</script>


  <footer class="bg-green-900 text-white py-6 px-6">
    <div class="container mx-auto text-center">
      <p class="mb-2">© 2025 Periódico Escolar - I.E. COMFAMILIAR</p>
    </div>
  </footer>
</body>
</html>
